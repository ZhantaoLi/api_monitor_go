<!DOCTYPE html>
<html lang="zh-CN" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Proxy Docs</title>

    <script src="/static/assets/vendor/tailwindcss.js"></script>
    <script src="/static/assets/tailwind.config.js"></script>

    <link rel="stylesheet" href="/static/assets/vendor/phosphor-bold.css">
    <link rel="stylesheet" href="/static/assets/css/styles.css?v=proxy-docs">
    <script src="/static/assets/js/main.js?v=proxy-docs"></script>
</head>

<body
    class="bg-zinc-100 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 min-h-screen bg-grid transition-colors duration-300">
    <nav
        class="sticky top-0 z-40 w-full bg-white/80 dark:bg-zinc-900/80 backdrop-blur-md border-b border-zinc-200 dark:border-zinc-800">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center">
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.location='/'">
                    <div class="relative w-8 h-8 flex items-center justify-center bg-zinc-900 dark:bg-white rounded-lg">
                        <i class="ph-bold ph-activity text-white dark:text-zinc-900 text-xl"></i>
                    </div>
                    <span class="text-xl font-bold text-zinc-900 dark:text-white">
                        API <span class="font-normal text-zinc-500 dark:text-zinc-400 ml-1">Monitor</span>
                    </span>
                </div>
                <a href="https://github.com/ZhantaoLi/api_monitor_go" target="_blank" rel="noopener noreferrer"
                    class="w-7 h-7 flex items-center justify-center rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-colors"
                    title="GitHub">
                    <i class="ph-bold ph-github-logo text-lg"></i>
                </a>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-4 py-8">
        <section class="glass-panel rounded-2xl border border-transparent p-6 md:p-8">
            <h1 class="text-2xl md:text-3xl font-bold mb-2">API 代理文档</h1>
            <p class="text-zinc-600 dark:text-zinc-400 mb-6">
                服务默认端口为 <code class="font-mono text-sm">8081</code>（可通过环境变量
                <code class="font-mono text-sm">PORT</code> 修改）。
            </p>

            <h2 class="text-lg font-bold mb-3">兼容端点</h2>
            <div class="overflow-x-auto rounded-xl border border-zinc-200 dark:border-zinc-700 mb-6">
                <table class="w-full text-sm">
                    <thead class="bg-zinc-50 dark:bg-zinc-900/70">
                        <tr>
                            <th class="text-left px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">端点</th>
                            <th class="text-left px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">兼容协议</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700"><code>GET /v1/models</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">OpenAI Models API</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">
                                <code>POST /v1/chat/completions</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">OpenAI Chat Completions
                                API</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700"><code>POST /v1/messages</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">Anthropic Messages API
                            </td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700"><code>POST /v1/responses</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">OpenAI Responses API</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">
                                <code>POST /v1beta/models/{model}:generateContent</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">Google Gemini API</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2"><code>POST /v1beta/models/{model}:streamGenerateContent</code></td>
                            <td class="px-3 py-2">Google Gemini Streaming API</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2 class="text-lg font-bold mb-3">核心约束（严格）</h2>
            <ul class="list-disc pl-6 text-zinc-700 dark:text-zinc-300 mb-6 space-y-1">
                <li>模型名称必须使用 <code>&lt;channel&gt;/&lt;model&gt;</code> 格式，例如 <code>&lt;channel&gt;/&lt;model&gt;</code>。</li>
                <li>模型名称必须与数据库中“最新检测结果里的成功模型”严格区分大小写并完全匹配。</li>
                <li><code>/v1/models</code> 仅返回检测成功的模型，并且 ID 格式统一为 <code>channel/model</code>。</li>
                <li>流式请求会透明转发，保持上游原始 SSE 格式，不改写事件内容。</li>
            </ul>

            <h2 class="text-lg font-bold mb-3">调用示例</h2>
            <pre class="rounded-xl bg-zinc-900 text-zinc-100 p-4 text-xs md:text-sm overflow-x-auto mb-3"><code>curl http://localhost:8081/v1/models \
  -H "Authorization: Bearer sk-your-proxy-key"</code></pre>
            <pre class="rounded-xl bg-zinc-900 text-zinc-100 p-4 text-xs md:text-sm overflow-x-auto mb-4"><code>curl http://localhost:8081/v1/chat/completions \
  -H "Authorization: Bearer sk-your-proxy-key" \
  -H "Content-Type: application/json" \
  -d '{"model":"&lt;channel&gt;/&lt;model&gt;","messages":[{"role":"user","content":"Hello"}]}'</code></pre>

            <h2 class="text-lg font-bold mb-3">可选路由控制</h2>
            <ul class="list-disc pl-6 text-zinc-700 dark:text-zinc-300 mb-6 space-y-1">
                <li>请求头 <code>X-Target-Id: &lt;id&gt;</code>：指定转发到某个渠道（需在 key 权限内）。</li>
                <li>或查询参数 <code>?target_id=&lt;id&gt;</code>。</li>
            </ul>

            <h2 class="text-lg font-bold mb-3">代理 Key 管理（管理员 API）</h2>
            <p class="text-zinc-600 dark:text-zinc-400 mb-2">
                需先登录 <code>/admin/login</code> 才能访问：
            </p>
            <div class="overflow-x-auto rounded-xl border border-zinc-200 dark:border-zinc-700 mb-4">
                <table class="w-full text-sm">
                    <thead class="bg-zinc-50 dark:bg-zinc-900/70">
                        <tr>
                            <th class="text-left px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">端点</th>
                            <th class="text-left px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">说明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700"><code>GET /api/proxy/keys</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">查看代理 Key 列表</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700"><code>POST /api/proxy/keys</code>
                            </td>
                            <td class="px-3 py-2 border-b border-zinc-200 dark:border-zinc-700">创建代理 Key（可限制渠道/模型）</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-2"><code>DELETE /api/proxy/keys/{id}</code></td>
                            <td class="px-3 py-2">撤销代理 Key</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="text-xs text-zinc-500 dark:text-zinc-400 border-t border-zinc-200 dark:border-zinc-800 pt-4">
                提示：如果你使用 Cherry Studio 等客户端，建议先请求一次 <code>/v1/models</code>，
                仅从返回列表中选择模型（即 <code>channel/model</code>）。
            </div>
        </section>
    </main>
</body>

</html>
